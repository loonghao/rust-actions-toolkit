name: 'Setup Rust CI'
description: 'Setup Rust toolchain for CI with optional checks'
author: 'rust-actions-toolkit'

branding:
  icon: 'settings'
  color: 'orange'

inputs:
  toolchain:
    description: 'Rust toolchain version'
    required: false
    default: 'stable'
  check-format:
    description: 'Run cargo fmt check'
    required: false
    default: 'true'
  check-clippy:
    description: 'Run cargo clippy check'
    required: false
    default: 'true'
  check-docs:
    description: 'Run cargo doc check'
    required: false
    default: 'true'

runs:
  using: 'composite'
  steps:
    - name: Install Rust toolchain
      uses: dtolnay/rust-toolchain@master
      with:
        toolchain: ${{ inputs.toolchain }}
        components: rustfmt, clippy

    - name: Setup Rust cache
      uses: Swatinem/rust-cache@v2
      with:
        cache-on-failure: true

    - name: Check formatting
      if: inputs.check-format == 'true'
      shell: bash
      run: |
        echo "ðŸŽ¨ Checking code formatting..."
        cargo fmt --all -- --check

    - name: Run Clippy
      if: inputs.check-clippy == 'true'
      shell: bash
      run: |
        echo "ðŸ“Ž Running Clippy..."
        cargo clippy --all-targets --all-features -- -D warnings

    - name: Check documentation
      if: inputs.check-docs == 'true'
      shell: bash
      run: |
        echo "ðŸ“š Checking documentation..."
        cargo doc --no-deps --document-private-items --all-features
      env:
        RUSTDOCFLAGS: "-D warnings"
